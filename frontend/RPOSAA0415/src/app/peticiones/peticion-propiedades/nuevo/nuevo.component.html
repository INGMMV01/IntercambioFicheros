<form [formGroup]="formulario" class="formulario" *ngIf="!cargando && !guardando">
  <div class="cabecera-contenido">
    <h2>Nueva propiedad de petición '{{idPeticion}}'</h2>
    <div class="botones">
      <button [routerLink]="['/', 'peticiones', idPeticion, 'propiedades']" mat-raised-button color="accent">
        <div class="icono-boton">
          <mat-icon>arrow_back</mat-icon> Volver
        </div>
      </button>
      <button [disabled]="formulario.invalid" style="margin-left: 0.5em" mat-raised-button color="primary"
        (click)="guardar()">
        <div class="icono-boton">
          <mat-icon>save</mat-icon>&nbsp;Guardar
        </div>
      </button>
    </div>
  </div>

  <mat-form-field class="formularioClave">
    <mat-label>Tipo de propiedad de petición</mat-label>
    <mat-select formControlName="clave" (selectionChange)="changeTipoDePropiedad($event.value)">
      <mat-option value="">{{ '-- Selecciona un valor --' }}</mat-option>
      <mat-option *ngFor="let tipo of tiposDePropiedadDePeticion" [value]="tipo.attributes.codigoDeTipoDePropiedad">
        {{ tipo.attributes.descripcion }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field class="formularioValor" *ngIf="!esPropiedadEstado">
    <mat-label>Valor</mat-label>
    <input #nombre matInput formControlName="valor" placeholder="Valor">
  </mat-form-field>

  <abanca-cargando [valorLoading]="cargandoEstadosPosibles" msg="Cargando estados..." *ngIf="esPropiedadEstado"></abanca-cargando>
  <mat-form-field class="formularioValorEstado" *ngIf="esPropiedadEstado && !cargandoEstadosPosibles">
    <mat-label>Valor</mat-label>
    <mat-select formControlName="valor">
      <mat-option value="">{{ '-- Selecciona un valor --' }}</mat-option>
      <mat-option *ngFor="let estado of estados" [value]="estado.attributes.codigoDeEstado.toString()">
        {{ estado.attributes.descripcion }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <div class="error-summary">
    <div *ngIf="formulario.invalid && formulario.get('clave')?.touched && formulario.get('clave')?.errors?.required"
      class="error-message">El campo tipo de propiedad de petición es obligatorio.</div>
    <div *ngIf="formulario.invalid && formulario.get('valor')?.touched && formulario.get('valor')?.errors?.required"
      class="error-message">El campo valor es obligatorio.</div>
  </div>

</form>
<mat-card *ngIf="cargando" class="mat-card-cargando">
  <mat-card-content>
    <abanca-cargando [valorLoading]="cargando" msg="Cargando..."></abanca-cargando>
  </mat-card-content>
</mat-card>
<mat-card *ngIf="guardando" class="mat-card-cargando">
  <mat-card-content>
    <abanca-cargando [valorLoading]="guardando" msg="Guardando..."></abanca-cargando>
  </mat-card-content>
</mat-card>
